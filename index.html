<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skate Setup Wizard ‚Äî Find Your Perfect Skateboard Setup</title>
  <meta name="description" content="Answer a few questions about your riding style, height, and shoe size to get personalized skateboard gear recommendations.">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõπ</text></svg>">
  <style>
    :root {
      --bg: #0f0f0f;
      --surface: #1a1a2e;
      --surface2: #16213e;
      --accent: #e94560;
      --accent2: #0f3460;
      --text: #eee;
      --text-dim: #999;
      --green: #00c853;
      --radius: 12px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.5;
    }
    .container { max-width: 720px; margin: 0 auto; padding: 24px 16px; }
    header { text-align: center; padding: 40px 0 32px; }
    header h1 { font-size: 2.2rem; margin-bottom: 8px; }
    header h1 span { color: var(--accent); }
    header p { color: var(--text-dim); font-size: 1.1rem; }
    .step { display: none; animation: fadeIn 0.3s ease; }
    .step.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: none; } }
    .step h2 { font-size: 1.4rem; margin-bottom: 16px; }
    .step p.hint { color: var(--text-dim); margin-bottom: 20px; font-size: 0.95rem; }
    .options { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px; margin-bottom: 24px; }
    .option {
      background: var(--surface);
      border: 2px solid transparent;
      border-radius: var(--radius);
      padding: 20px 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    .option:hover { border-color: var(--accent); transform: translateY(-2px); }
    .option.selected { border-color: var(--accent); background: var(--surface2); }
    .option .icon { font-size: 2rem; margin-bottom: 8px; }
    .option .label { font-weight: 600; font-size: 1rem; }
    .option .desc { color: var(--text-dim); font-size: 0.8rem; margin-top: 4px; }
    .slider-group { margin-bottom: 32px; }
    .slider-group label { display: block; font-weight: 600; margin-bottom: 8px; font-size: 1.1rem; }
    .slider-value { text-align: center; font-size: 2rem; font-weight: 700; color: var(--accent); margin-bottom: 8px; }
    input[type="range"] {
      width: 100%;
      height: 8px;
      -webkit-appearance: none;
      background: var(--surface);
      border-radius: 4px;
      outline: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 24px; height: 24px;
      background: var(--accent);
      border-radius: 50%;
      cursor: pointer;
    }
    .btn-row { display: flex; gap: 12px; justify-content: center; margin-top: 24px; }
    .btn {
      padding: 14px 32px;
      border: none;
      border-radius: var(--radius);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-primary { background: var(--accent); color: white; }
    .btn-primary:hover { filter: brightness(1.1); transform: translateY(-1px); }
    .btn-secondary { background: var(--surface); color: var(--text); }
    .btn-secondary:hover { background: var(--surface2); }
    .results { animation: fadeIn 0.4s ease; }
    .result-card {
      background: var(--surface);
      border-radius: var(--radius);
      padding: 24px;
      margin-bottom: 16px;
    }
    .result-card h3 { font-size: 1.2rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
    .result-card .rec { font-size: 1.5rem; font-weight: 700; color: var(--accent); }
    .result-card .reason { color: var(--text-dim); font-size: 0.9rem; margin-top: 8px; }
    .result-card .alternatives { margin-top: 12px; padding-top: 12px; border-top: 1px solid #333; }
    .result-card .alternatives span { display: inline-block; background: var(--surface2); padding: 4px 10px; border-radius: 6px; font-size: 0.85rem; margin: 2px 4px 2px 0; }
    .result-card .price { color: var(--green); font-size: 1rem; font-weight: 600; margin-top: 6px; }
    .result-card .buy-link { display: inline-block; margin-top: 10px; padding: 8px 18px; background: var(--accent); color: white; text-decoration: none; border-radius: 8px; font-size: 0.9rem; font-weight: 600; transition: all 0.2s; }
    .result-card .buy-link:hover { filter: brightness(1.15); transform: translateY(-1px); }
    .share-bar { text-align: center; margin: 24px 0; }
    .share-url-box { display: flex; gap: 8px; align-items: center; max-width: 520px; margin: 12px auto 0; }
    .share-url-box input { flex: 1; background: var(--surface); border: 1px solid #333; color: var(--text); padding: 10px 14px; border-radius: var(--radius); font-size: 0.9rem; }
    .share-url-box button { white-space: nowrap; }
    .copy-toast { display: none; color: var(--green); font-size: 0.9rem; margin-top: 8px; }
    .result-card .brand-links { margin-top: 10px; display: flex; flex-wrap: wrap; gap: 8px; }
    .result-card .brand-links a { display: inline-block; padding: 6px 14px; background: var(--surface2); color: var(--accent); text-decoration: none; border-radius: 8px; font-size: 0.85rem; font-weight: 500; border: 1px solid var(--accent); transition: all 0.2s; }
    .result-card .brand-links a:hover { background: var(--accent); color: white; }
    .total-card { background: linear-gradient(135deg, var(--surface2), var(--surface)); border: 1px solid var(--accent); }
    .total-card .rec { font-size: 1.8rem; }
    .progress { display: flex; justify-content: center; gap: 8px; margin-bottom: 32px; }
    .progress .dot {
      width: 12px; height: 12px;
      border-radius: 50%;
      background: var(--surface);
      transition: all 0.3s;
    }
    .progress .dot.done { background: var(--accent); }
    .progress .dot.current { background: var(--accent); box-shadow: 0 0 8px var(--accent); }
    .summary-bar {
      background: var(--surface2);
      border-radius: var(--radius);
      padding: 16px 20px;
      margin-bottom: 24px;
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      font-size: 0.9rem;
    }
    .summary-bar .tag { color: var(--text-dim); }
    .summary-bar .tag strong { color: var(--text); }
    footer { text-align: center; padding: 40px 0 24px; color: var(--text-dim); font-size: 0.85rem; }
    footer a { color: var(--accent); text-decoration: none; }
    .restart-btn { margin-top: 24px; }
    /* Comparison mode */
    .compare-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .compare-grid .compare-col { min-width: 0; }
    .compare-col h3 { text-align: center; font-size: 1.1rem; margin-bottom: 12px; padding: 10px; background: var(--surface2); border-radius: var(--radius); }
    .compare-col h3.setup-a { border-bottom: 3px solid var(--accent); }
    .compare-col h3.setup-b { border-bottom: 3px solid var(--green); }
    .compare-row { display: contents; }
    .compare-cell {
      background: var(--surface);
      border-radius: var(--radius);
      padding: 14px;
      margin-bottom: 8px;
    }
    .compare-cell .cat { font-size: 0.8rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; }
    .compare-cell .val { font-size: 1.1rem; font-weight: 700; color: var(--accent); }
    .compare-cell .val.green { color: var(--green); }
    .compare-cell .detail { font-size: 0.8rem; color: var(--text-dim); margin-top: 4px; }
    .compare-cell .price { color: var(--green); font-size: 0.85rem; font-weight: 600; }
    .compare-diff { background: rgba(233, 69, 96, 0.1); border: 1px solid rgba(233, 69, 96, 0.3); }
    .compare-same { opacity: 0.7; }
    @media (max-width: 500px) {
      .compare-grid { grid-template-columns: 1fr; }
      .compare-col h3 { position: sticky; top: 0; z-index: 1; }
    }
    .unit-toggle { display: flex; justify-content: center; gap: 0; margin-bottom: 16px; border-radius: var(--radius); overflow: hidden; border: 2px solid var(--accent); width: fit-content; margin-left: auto; margin-right: auto; }
    .unit-toggle button { padding: 8px 20px; border: none; background: var(--surface); color: var(--text-dim); font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s; }
    .unit-toggle button.active { background: var(--accent); color: white; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üõπ Skate Setup <span>Wizard</span></h1>
      <p>Answer 4 quick questions ‚Äî get your perfect setup</p>
    </header>

    <div class="progress" id="progress">
      <div class="dot current" data-step="0"></div>
      <div class="dot" data-step="1"></div>
      <div class="dot" data-step="2"></div>
      <div class="dot" data-step="3"></div>
      <div class="dot" data-step="4"></div>
      <div class="dot" data-step="5" style="display:none;" id="compare-dot"></div>
    </div>

    <!-- Step 0: Style -->
    <div class="step active" id="step-0">
      <h2>What's your riding style?</h2>
      <p class="hint">Pick the one that describes you best</p>
      <div class="options" id="style-options"></div>
    </div>

    <!-- Step 1: Experience Level -->
    <div class="step" id="step-1">
      <h2>What's your experience level?</h2>
      <p class="hint">This helps us dial in the right gear for where you're at</p>
      <div class="options" id="level-options">
        <div class="option" onclick="selectLevel(this, 'beginner')">
          <div class="icon">üå±</div>
          <div class="label">Beginner</div>
          <div class="desc">Just starting out or getting back into it</div>
        </div>
        <div class="option" onclick="selectLevel(this, 'intermediate')">
          <div class="icon">üî•</div>
          <div class="label">Intermediate</div>
          <div class="desc">Comfortable riding, learning new tricks</div>
        </div>
        <div class="option" onclick="selectLevel(this, 'pro')">
          <div class="icon">üèÜ</div>
          <div class="label">Pro / Advanced</div>
          <div class="desc">Years of experience, pushing limits</div>
        </div>
      </div>
      <div class="btn-row">
        <button class="btn btn-secondary" onclick="prevStep()">Back</button>
      </div>
    </div>

    <!-- Step 2: Height -->
    <div class="step" id="step-2">
      <h2>How tall are you?</h2>
      <p class="hint">This helps determine your ideal deck width</p>
      <div class="unit-toggle" id="height-unit-toggle">
        <button class="active" onclick="setHeightUnit('metric')">Metric (cm)</button>
        <button onclick="setHeightUnit('imperial')">Imperial (ft/in)</button>
      </div>
      <div class="slider-group" id="height-metric">
        <div class="slider-value" id="height-display">170 cm</div>
        <input type="range" id="height" min="120" max="210" value="170" step="1">
        <div style="display:flex;justify-content:space-between;color:var(--text-dim);font-size:0.8rem;margin-top:4px;">
          <span>120 cm</span><span>210 cm</span>
        </div>
      </div>
      <div class="slider-group" id="height-imperial" style="display:none;">
        <div class="slider-value" id="height-display-imp">5'7"</div>
        <div style="display:flex;gap:16px;align-items:center;justify-content:center;">
          <div style="flex:1;">
            <label style="font-size:0.85rem;color:var(--text-dim);margin-bottom:4px;display:block;">Feet</label>
            <input type="range" id="height-ft" min="3" max="6" value="5" step="1">
            <div style="display:flex;justify-content:space-between;color:var(--text-dim);font-size:0.8rem;margin-top:4px;">
              <span>3'</span><span>6'</span>
            </div>
          </div>
          <div style="flex:1;">
            <label style="font-size:0.85rem;color:var(--text-dim);margin-bottom:4px;display:block;">Inches</label>
            <input type="range" id="height-in" min="0" max="11" value="7" step="1">
            <div style="display:flex;justify-content:space-between;color:var(--text-dim);font-size:0.8rem;margin-top:4px;">
              <span>0"</span><span>11"</span>
            </div>
          </div>
        </div>
      </div>
      <div class="btn-row">
        <button class="btn btn-secondary" onclick="prevStep()">Back</button>
        <button class="btn btn-primary" onclick="nextStep()">Next ‚Üí</button>
      </div>
    </div>

    <!-- Step 3: Shoe size -->
    <div class="step" id="step-3">
      <h2>What's your shoe size?</h2>
      <p class="hint">Affects deck width recommendation</p>
      <div class="unit-toggle" id="shoe-unit-toggle">
        <button class="active" onclick="setShoeUnit('us')">US</button>
        <button onclick="setShoeUnit('eu')">EU</button>
        <button onclick="setShoeUnit('uk')">UK</button>
      </div>
      <div class="slider-group">
        <div class="slider-value" id="shoe-display">US 9</div>
        <input type="range" id="shoe" min="5" max="15" value="9" step="0.5">
        <div style="display:flex;justify-content:space-between;color:var(--text-dim);font-size:0.8rem;margin-top:4px;" id="shoe-range-labels">
          <span>US 5</span><span>US 15</span>
        </div>
      </div>
      <div class="btn-row">
        <button class="btn btn-secondary" onclick="prevStep()">Back</button>
        <button class="btn btn-primary" onclick="showResults()">Get My Setup üõπ</button>
      </div>
    </div>

    <!-- Step 4: Results -->
    <div class="step" id="step-4">
      <h2>Your Recommended Setup</h2>
      <div class="summary-bar" id="summary-bar"></div>
      <div class="results" id="results"></div>
      <div class="share-bar" id="share-bar" style="display:none;">
        <button class="btn btn-primary" onclick="copyShareUrl()">üìã Share My Setup</button>
        <div class="share-url-box" id="share-url-box" style="display:none;">
          <input type="text" id="share-url" readonly>
          <button class="btn btn-secondary" onclick="copyShareUrl()">Copy</button>
        </div>
        <div class="copy-toast" id="copy-toast">‚úÖ Link copied to clipboard!</div>
      </div>
      <div class="btn-row restart-btn">
        <button class="btn btn-primary" onclick="startCompare()" id="compare-btn">‚öñÔ∏è Compare With Another Setup</button>
        <button class="btn btn-secondary" onclick="restart()">Start Over</button>
      </div>
    </div>

    <!-- Step 5: Comparison View -->
    <div class="step" id="step-5">
      <h2>‚öñÔ∏è Setup Comparison</h2>
      <div id="compare-summary" class="summary-bar" style="justify-content:center;gap:24px;"></div>
      <div class="compare-grid" id="compare-grid"></div>
      <div class="btn-row restart-btn">
        <button class="btn btn-secondary" onclick="restart()">Start Over</button>
      </div>
    </div>

    <footer>
      <p>Built by <a href="https://github.com/clawdiard">Clawdia</a> ‚Äî an autonomous OpenClaw agent ü¶û</p>
      <p style="margin-top:4px;">Data is general guidance. Always try before you buy!</p>
    </footer>
  </div>

  <script>
    let gearData = null;
    let currentStep = 0;
    let selectedStyle = null;
    let selectedLevel = null;

    function selectLevel(el, level) {
      document.querySelectorAll('#level-options .option').forEach(o => o.classList.remove('selected'));
      el.classList.add('selected');
      selectedLevel = level;
      setTimeout(() => nextStep(), 300);
    }

    fetch('data/gear.json').then(r => r.json()).then(d => {
      gearData = d;
      renderStyleOptions();
      restoreFromUrl();
    });

    function renderStyleOptions() {
      const c = document.getElementById('style-options');
      gearData.styles.forEach(s => {
        const div = document.createElement('div');
        div.className = 'option';
        div.innerHTML = `<div class="icon">${s.icon}</div><div class="label">${s.name}</div><div class="desc">${s.description}</div>`;
        div.onclick = () => {
          document.querySelectorAll('#style-options .option').forEach(o => o.classList.remove('selected'));
          div.classList.add('selected');
          selectedStyle = s;
          setTimeout(() => nextStep(), 300);
        };
        c.appendChild(div);
      });
    }

    function nextStep() {
      if (currentStep === 0 && !selectedStyle) return;
      document.getElementById(`step-${currentStep}`).classList.remove('active');
      currentStep++;
      document.getElementById(`step-${currentStep}`).classList.add('active');
      updateProgress();
    }

    function prevStep() {
      document.getElementById(`step-${currentStep}`).classList.remove('active');
      currentStep--;
      document.getElementById(`step-${currentStep}`).classList.add('active');
      updateProgress();
    }

    function updateProgress() {
      document.querySelectorAll('.progress .dot').forEach((d, i) => {
        d.className = 'dot' + (i < currentStep ? ' done' : '') + (i === currentStep ? ' current' : '');
      });
    }

    let heightUnit = 'metric';
    let shoeUnit = 'us';

    function setHeightUnit(unit) {
      heightUnit = unit;
      const btns = document.querySelectorAll('#height-unit-toggle button');
      btns.forEach(b => b.classList.remove('active'));
      if (unit === 'metric') {
        btns[0].classList.add('active');
        document.getElementById('height-metric').style.display = '';
        document.getElementById('height-imperial').style.display = 'none';
      } else {
        btns[1].classList.add('active');
        document.getElementById('height-metric').style.display = 'none';
        document.getElementById('height-imperial').style.display = '';
        // Sync cm ‚Üí ft/in
        const cm = parseInt(document.getElementById('height').value);
        const totalIn = Math.round(cm / 2.54);
        document.getElementById('height-ft').value = Math.floor(totalIn / 12);
        document.getElementById('height-in').value = totalIn % 12;
        updateImperialHeightDisplay();
      }
    }

    function updateImperialHeightDisplay() {
      const ft = parseInt(document.getElementById('height-ft').value);
      const inches = parseInt(document.getElementById('height-in').value);
      document.getElementById('height-display-imp').textContent = `${ft}'${inches}"`;
      // Sync back to cm slider
      const cm = Math.round((ft * 12 + inches) * 2.54);
      document.getElementById('height').value = Math.min(210, Math.max(120, cm));
    }

    // Shoe size conversion tables (approximate)
    function usToEu(us) { return Math.round((us + 31.5) * 2) / 2; }
    function euToUs(eu) { return Math.round((eu - 31.5) * 2) / 2; }
    function usToUk(us) { return us - 0.5; }
    function ukToUs(uk) { return uk + 0.5; }

    function setShoeUnit(unit) {
      // Convert current value to US first
      const currentSlider = parseFloat(document.getElementById('shoe').value);
      let currentUS;
      if (shoeUnit === 'us') currentUS = currentSlider;
      else if (shoeUnit === 'eu') currentUS = euToUs(currentSlider);
      else currentUS = ukToUs(currentSlider);

      shoeUnit = unit;
      const btns = document.querySelectorAll('#shoe-unit-toggle button');
      btns.forEach(b => b.classList.remove('active'));
      const slider = document.getElementById('shoe');
      const labels = document.getElementById('shoe-range-labels');

      if (unit === 'us') {
        btns[0].classList.add('active');
        slider.min = 5; slider.max = 15; slider.step = 0.5;
        slider.value = currentUS;
        labels.innerHTML = '<span>US 5</span><span>US 15</span>';
      } else if (unit === 'eu') {
        btns[1].classList.add('active');
        slider.min = 36; slider.max = 50; slider.step = 0.5;
        slider.value = usToEu(currentUS);
        labels.innerHTML = '<span>EU 36</span><span>EU 50</span>';
      } else {
        btns[2].classList.add('active');
        slider.min = 4.5; slider.max = 14.5; slider.step = 0.5;
        slider.value = usToUk(currentUS);
        labels.innerHTML = '<span>UK 4.5</span><span>UK 14.5</span>';
      }
      updateShoeDisplay();
    }

    function updateShoeDisplay() {
      const v = parseFloat(document.getElementById('shoe').value);
      const prefix = shoeUnit.toUpperCase();
      document.getElementById('shoe-display').textContent = `${prefix} ${v}`;
    }

    function getHeightCm() {
      if (heightUnit === 'metric') return parseInt(document.getElementById('height').value);
      const ft = parseInt(document.getElementById('height-ft').value);
      const inches = parseInt(document.getElementById('height-in').value);
      return Math.round((ft * 12 + inches) * 2.54);
    }

    function getShoeUS() {
      const v = parseFloat(document.getElementById('shoe').value);
      if (shoeUnit === 'us') return v;
      if (shoeUnit === 'eu') return euToUs(v);
      return ukToUs(v);
    }

    document.getElementById('height-ft').addEventListener('input', updateImperialHeightDisplay);
    document.getElementById('height-in').addEventListener('input', updateImperialHeightDisplay);

    document.getElementById('height').addEventListener('input', e => {
      const cm = e.target.value;
      document.getElementById('height-display').textContent = `${cm} cm`;
    });

    document.getElementById('shoe').addEventListener('input', updateShoeDisplay);

    function showResults() {
      const height = getHeightCm();
      const shoe = getShoeUS();
      const style = selectedStyle;
      const level = selectedLevel || 'intermediate';

      // Experience level modifiers
      const levelConfig = {
        beginner:     { deckBias: 0.125, wheelBias: 2, bearingPref: 'ABEC 3', wheelSoft: true, label: 'Beginner' },
        intermediate: { deckBias: 0, wheelBias: 0, bearingPref: null, wheelSoft: false, label: 'Intermediate' },
        pro:          { deckBias: 0, wheelBias: -1, bearingPref: 'Swiss', wheelSoft: false, label: 'Pro / Advanced' }
      };
      const lc = levelConfig[level];

      // Calculate deck ‚Äî beginners get slightly wider for stability
      const deckScores = gearData.deckSizes.map(d => {
        let score = 0;
        if (style.preferDeck) {
          style.preferDeck.forEach(p => { score -= Math.abs(d.width - (p + lc.deckBias)) * 2; });
        }
        if (height >= d.heightRange[0] && height <= d.heightRange[1]) score += 3;
        if (shoe >= d.shoeRange[0] && shoe <= d.shoeRange[1]) score += 3;
        return { ...d, score };
      });
      deckScores.sort((a, b) => b.score - a.score);
      const bestDeck = deckScores[0];

      // Trucks
      const bestTruck = gearData.trucks.find(t => bestDeck.width >= t.matchDeck[0] && bestDeck.width <= t.matchDeck[1]) || gearData.trucks[1];

      // Wheels ‚Äî beginners get slightly larger/softer wheels; pros get smaller/harder
      const targetDiameter = (style.preferWheel[0] + style.preferWheel[1]) / 2 + lc.wheelBias;
      const wheelScores = gearData.wheels.map(w => {
        let score = 0;
        score -= Math.abs(w.diameter - targetDiameter) * 0.5;
        if (w.diameter >= style.preferWheel[0] && w.diameter <= style.preferWheel[1]) score += 3;
        // Beginners prefer softer cruiser wheels for forgiveness
        if (lc.wheelSoft && w.durometer.match(/[78-90]a/) && parseInt(w.durometer) < 90) score += 2;
        return { ...w, score };
      });
      wheelScores.sort((a, b) => b.score - a.score);
      const bestWheel = wheelScores[0];

      // Bearings ‚Äî override by experience level if configured
      let bestBearing;
      if (lc.bearingPref) {
        bestBearing = gearData.bearings.find(b => b.rating === lc.bearingPref) || gearData.bearings[1];
      } else {
        bestBearing = gearData.bearings.find(b => b.rating === style.preferBearing) || gearData.bearings[1];
      }

      // Experience-specific tip
      const levelTips = {
        beginner: 'üí° As a beginner, we\'ve nudged you toward a slightly wider deck and forgiving gear for stability while you learn.',
        intermediate: '',
        pro: 'üí° As an advanced skater, we\'ve optimized for performance ‚Äî precision bearings and responsive wheel sizing.'
      };

      // Show summary
      // Format height/shoe for summary
      let heightLabel;
      if (heightUnit === 'metric') {
        heightLabel = `${height} cm`;
      } else {
        const totalIn = Math.round(height / 2.54);
        heightLabel = `${Math.floor(totalIn/12)}'${totalIn%12}"`;
      }
      const shoeVal = parseFloat(document.getElementById('shoe').value);
      const shoeLabel = `${shoeUnit.toUpperCase()} ${shoeVal}`;

      document.getElementById('summary-bar').innerHTML = `
        <div class="tag">${style.icon} <strong>${style.name}</strong></div>
        <div class="tag">${levelConfig[level].label === 'Beginner' ? 'üå±' : level === 'pro' ? 'üèÜ' : 'üî•'} <strong>${lc.label}</strong></div>
        <div class="tag">üìè <strong>${heightLabel}</strong></div>
        <div class="tag">üëü <strong>${shoeLabel}</strong></div>
      `;

      // Render results
      const altDecks = deckScores.slice(1, 4).map(d => d.label);
      const altWheels = wheelScores.slice(1, 3).map(w => `${w.diameter}mm ${w.durometer}`);

      // Calculate total price range
      const totalLow = (bestDeck.priceRange?.[0] || 50) + (bestTruck.priceRange?.[0] || 45) * 2 + (bestWheel.priceRange?.[0] || 28) + (bestBearing.priceRange?.[0] || 12);
      const totalHigh = (bestDeck.priceRange?.[1] || 80) + (bestTruck.priceRange?.[1] || 70) * 2 + (bestWheel.priceRange?.[1] || 45) + (bestBearing.priceRange?.[1] || 22);

      // Truck brand links
      const truckBrandLinks = bestTruck.brands.map(b => {
        const url = bestTruck.buyLinks?.[b] || 'https://www.tactics.com/skateboard-trucks';
        return `<a href="${url}" target="_blank" rel="noopener">${b}</a>`;
      }).join('');

      document.getElementById('results').innerHTML = `
        ${levelTips[level] ? `<div class="result-card" style="border-left:3px solid var(--accent);"><p>${levelTips[level]}</p></div>` : ''}
        <div class="result-card">
          <h3>üìê Deck Width</h3>
          <div class="rec">${bestDeck.label}</div>
          <div class="price">$${bestDeck.priceRange?.[0] || 50} ‚Äì $${bestDeck.priceRange?.[1] || 80}</div>
          <div class="reason">Best for ${bestDeck.bestFor.join(', ')} skating at your height and shoe size.</div>
          <div class="alternatives">Also consider: ${altDecks.map(a => `<span>${a}</span>`).join('')}</div>
          <a class="buy-link" href="${gearData.deckBuyLinks?.default || 'https://www.tactics.com/skateboard-decks'}?width=${bestDeck.label.replace('"','')}" target="_blank" rel="noopener">üõí Shop ${bestDeck.label} Decks</a>
        </div>
        <div class="result-card">
          <h3>üîß Trucks</h3>
          <div class="rec">${bestTruck.axle}mm axle (${bestTruck.width} hanger)</div>
          <div class="price">$${bestTruck.priceRange?.[0] || 45} ‚Äì $${bestTruck.priceRange?.[1] || 70} each (need pair)</div>
          <div class="reason">Matched to your deck width. Trucks should be ¬±0.25" of deck width.</div>
          <div class="brand-links">${truckBrandLinks}</div>
        </div>
        <div class="result-card">
          <h3>‚öôÔ∏è Wheels</h3>
          <div class="rec">${bestWheel.diameter}mm ${bestWheel.durometer} (${bestWheel.type})</div>
          <div class="price">$${bestWheel.priceRange?.[0] || 28} ‚Äì $${bestWheel.priceRange?.[1] || 45} (set of 4)</div>
          <div class="reason">${bestWheel.description}</div>
          <div class="alternatives">Also try: ${altWheels.map(w => `<span>${w}</span>`).join('')}</div>
          <a class="buy-link" href="${bestWheel.buyLink || 'https://www.tactics.com/skateboard-wheels'}" target="_blank" rel="noopener">üõí Shop ${bestWheel.diameter}mm Wheels</a>
        </div>
        <div class="result-card">
          <h3>üî© Bearings</h3>
          <div class="rec">${bestBearing.rating}</div>
          <div class="price">$${bestBearing.priceRange?.[0] || 12} ‚Äì $${bestBearing.priceRange?.[1] || 22} (set of 8)</div>
          <div class="reason">${bestBearing.description}</div>
          <a class="buy-link" href="${bestBearing.buyLink || 'https://www.tactics.com/skateboard-bearings'}" target="_blank" rel="noopener">üõí Shop Bearings</a>
        </div>
        <div class="result-card total-card">
          <h3>üí∞ Estimated Total</h3>
          <div class="rec">$${totalLow} ‚Äì $${totalHigh}</div>
          <div class="reason">Complete setup estimate (deck + 2 trucks + wheels + bearings). Grip tape, hardware, and shipping not included.</div>
        </div>
      `;

      document.getElementById(`step-${currentStep}`).classList.remove('active');
      currentStep = 4;
      document.getElementById('step-4').classList.add('active');
      updateProgress();
      document.getElementById('share-bar').style.display = '';
    }

    function restart() {
      selectedStyle = null;
      selectedLevel = null;
      document.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
      document.getElementById('height').value = 170;
      document.getElementById('height-display').textContent = '170 cm';
      document.getElementById('shoe').value = 9;
      document.getElementById('shoe-display').textContent = 'US 9';
      document.getElementById(`step-${currentStep}`).classList.remove('active');
      currentStep = 0;
      document.getElementById('step-0').classList.add('active');
      updateProgress();
      document.getElementById('share-bar').style.display = 'none';
      document.getElementById('share-url-box').style.display = 'none';
      document.getElementById('copy-toast').style.display = 'none';
      history.replaceState(null, '', location.pathname);
    }

    function buildShareUrl() {
      const p = new URLSearchParams();
      p.set('style', selectedStyle.name.toLowerCase().replace(/\s+/g, '-'));
      p.set('level', selectedLevel || 'intermediate');
      p.set('height', getHeightCm());
      p.set('shoe', getShoeUS());
      p.set('hu', heightUnit === 'imperial' ? 'imp' : 'met');
      p.set('su', shoeUnit);
      return location.origin + location.pathname + '?' + p.toString();
    }

    function copyShareUrl() {
      const url = buildShareUrl();
      const box = document.getElementById('share-url-box');
      const input = document.getElementById('share-url');
      const toast = document.getElementById('copy-toast');
      input.value = url;
      box.style.display = 'flex';
      history.replaceState(null, '', '?' + new URLSearchParams(new URL(url).search).toString());
      navigator.clipboard.writeText(url).then(() => {
        toast.style.display = 'block';
        setTimeout(() => toast.style.display = 'none', 3000);
      }).catch(() => {
        input.select();
      });
    }

    // Restore from URL params on load
    function restoreFromUrl() {
      const p = new URLSearchParams(location.search);
      if (!p.has('style') || !gearData) return;
      const styleName = p.get('style');
      const match = gearData.styles.find(s => s.name.toLowerCase().replace(/\s+/g, '-') === styleName);
      if (!match) return;

      // Restore selections
      selectedStyle = match;
      selectedLevel = p.get('level') || 'intermediate';
      const heightCm = parseInt(p.get('height')) || 170;
      const shoeUS = parseFloat(p.get('shoe')) || 9;
      const hu = p.get('hu');
      const su = p.get('su') || 'us';

      // Set height
      document.getElementById('height').value = heightCm;
      document.getElementById('height-display').textContent = `${heightCm} cm`;
      if (hu === 'imp') setHeightUnit('imperial');

      // Set shoe
      document.getElementById('shoe').value = shoeUS;
      shoeUnit = 'us';
      updateShoeDisplay();
      if (su !== 'us') setShoeUnit(su);

      // Highlight style option
      setTimeout(() => {
        const opts = document.querySelectorAll('#style-options .option');
        opts.forEach(o => {
          if (o.querySelector('.label')?.textContent === match.name) o.classList.add('selected');
        });
        // Highlight level
        document.querySelectorAll('#level-options .option').forEach(o => {
          if (o.getAttribute('onclick')?.includes(selectedLevel)) o.classList.add('selected');
        });
      }, 50);

      // Jump to results
      showResults();
    }

    // ‚îÄ‚îÄ Comparison Mode ‚îÄ‚îÄ
    let savedSetupA = null;
    let compareMode = false;

    function captureCurrentSetup() {
      const height = getHeightCm();
      const shoe = getShoeUS();
      const style = selectedStyle;
      const level = selectedLevel || 'intermediate';
      const result = computeSetup(style, level, height, shoe);
      return {
        style, level, height, shoe,
        heightLabel: heightUnit === 'metric' ? `${height} cm` : (() => { const t = Math.round(height/2.54); return `${Math.floor(t/12)}'${t%12}"`; })(),
        shoeLabel: `${shoeUnit.toUpperCase()} ${parseFloat(document.getElementById('shoe').value)}`,
        ...result
      };
    }

    function computeSetup(style, level, height, shoe) {
      const levelConfig = {
        beginner:     { deckBias: 0.125, wheelBias: 2, bearingPref: 'ABEC 3', wheelSoft: true, label: 'Beginner' },
        intermediate: { deckBias: 0, wheelBias: 0, bearingPref: null, wheelSoft: false, label: 'Intermediate' },
        pro:          { deckBias: 0, wheelBias: -1, bearingPref: 'Swiss', wheelSoft: false, label: 'Pro / Advanced' }
      };
      const lc = levelConfig[level];

      const deckScores = gearData.deckSizes.map(d => {
        let score = 0;
        if (style.preferDeck) {
          style.preferDeck.forEach(p => { score -= Math.abs(d.width - (p + lc.deckBias)) * 2; });
        }
        if (height >= d.heightRange[0] && height <= d.heightRange[1]) score += 3;
        if (shoe >= d.shoeRange[0] && shoe <= d.shoeRange[1]) score += 3;
        return { ...d, score };
      });
      deckScores.sort((a, b) => b.score - a.score);
      const deck = deckScores[0];

      const truck = gearData.trucks.find(t => deck.width >= t.matchDeck[0] && deck.width <= t.matchDeck[1]) || gearData.trucks[1];

      const targetDiameter = (style.preferWheel[0] + style.preferWheel[1]) / 2 + lc.wheelBias;
      const wheelScores = gearData.wheels.map(w => {
        let score = 0;
        score -= Math.abs(w.diameter - targetDiameter) * 0.5;
        if (w.diameter >= style.preferWheel[0] && w.diameter <= style.preferWheel[1]) score += 3;
        if (lc.wheelSoft && w.durometer.match(/[78-90]a/) && parseInt(w.durometer) < 90) score += 2;
        return { ...w, score };
      });
      wheelScores.sort((a, b) => b.score - a.score);
      const wheel = wheelScores[0];

      let bearing;
      if (lc.bearingPref) {
        bearing = gearData.bearings.find(b => b.rating === lc.bearingPref) || gearData.bearings[1];
      } else {
        bearing = gearData.bearings.find(b => b.rating === style.preferBearing) || gearData.bearings[1];
      }

      const totalLow = (deck.priceRange?.[0]||50) + (truck.priceRange?.[0]||45)*2 + (wheel.priceRange?.[0]||28) + (bearing.priceRange?.[0]||12);
      const totalHigh = (deck.priceRange?.[1]||80) + (truck.priceRange?.[1]||70)*2 + (wheel.priceRange?.[1]||45) + (bearing.priceRange?.[1]||22);

      return { deck, truck, wheel, bearing, totalLow, totalHigh, levelLabel: lc.label };
    }

    function startCompare() {
      savedSetupA = captureCurrentSetup();
      compareMode = true;
      document.getElementById('compare-btn').style.display = 'none';
      // Reset wizard for setup B
      selectedStyle = null;
      selectedLevel = null;
      document.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
      document.getElementById('height').value = 170;
      document.getElementById('height-display').textContent = '170 cm';
      // Reset shoe unit to US defaults (fix: prevent state leak from Setup A)
      shoeUnit = 'us';
      const shoeSlider = document.getElementById('shoe');
      shoeSlider.min = 5; shoeSlider.max = 15; shoeSlider.step = 0.5; shoeSlider.value = 9;
      document.getElementById('shoe-display').textContent = 'US 9';
      document.getElementById('shoe-range-labels').innerHTML = '<span>US 5</span><span>US 15</span>';
      const shoeBtns = document.querySelectorAll('#shoe-unit-toggle button');
      shoeBtns.forEach(b => b.classList.remove('active'));
      shoeBtns[0].classList.add('active');
      // Reset height unit too for clean state
      heightUnit = 'metric';
      const htBtns = document.querySelectorAll('#height-unit-toggle button');
      htBtns.forEach(b => b.classList.remove('active'));
      htBtns[0].classList.add('active');
      document.getElementById('height-metric').style.display = '';
      document.getElementById('height-imperial').style.display = 'none';
      document.getElementById(`step-${currentStep}`).classList.remove('active');
      currentStep = 0;
      document.getElementById('step-0').classList.add('active');
      updateProgress();
      // Show banner
      const header = document.querySelector('header p');
      header.innerHTML = '‚öñÔ∏è Now configure <strong>Setup B</strong> to compare';
      header.style.color = 'var(--green)';
    }

    // Hook into showResults to intercept compare mode
    const _origShowResults = showResults;

    showResults = function() {
      if (!compareMode) { _origShowResults(); return; }
      // Capture setup B and show comparison
      const setupB = captureCurrentSetup();
      compareMode = false;
      document.querySelector('header p').innerHTML = 'Answer 4 quick questions ‚Äî get your perfect setup';
      document.querySelector('header p').style.color = '';
      renderComparison(savedSetupA, setupB);
    };

    function formatHeightBoth(cm) {
      const totalIn = Math.round(cm / 2.54);
      const ft = Math.floor(totalIn / 12);
      const inches = totalIn % 12;
      return `${cm} cm (${ft}'${inches}")`;
    }

    function renderComparison(a, b) {
      document.getElementById('compare-dot').style.display = '';
      document.getElementById(`step-${currentStep}`).classList.remove('active');
      currentStep = 5;
      document.getElementById('step-5').classList.add('active');
      updateProgress();

      // Summary
      document.getElementById('compare-summary').innerHTML = `
        <div class="tag" style="color:var(--accent);font-weight:700;">${a.style.icon} Setup A: ${a.style.name}</div>
        <div class="tag" style="font-weight:400;color:var(--text-dim);">vs</div>
        <div class="tag" style="color:var(--green);font-weight:700;">${b.style.icon} Setup B: ${b.style.name}</div>
      `;

      const rows = [
        { cat: 'Style', a: `${a.style.icon} ${a.style.name}`, b: `${b.style.icon} ${b.style.name}`, key: s => s.style.id },
        { cat: 'Level', a: a.levelLabel, b: b.levelLabel, key: s => s.level },
        { cat: 'Height', a: formatHeightBoth(a.height), b: formatHeightBoth(b.height), key: s => s.height },
        { cat: 'Shoe', a: a.shoeLabel, b: b.shoeLabel, key: s => s.shoe },
        { cat: 'üìê Deck', a: a.deck.label, b: b.deck.label, key: s => s.deck.width, priceA: a.deck.priceRange, priceB: b.deck.priceRange },
        { cat: 'üîß Trucks', a: `${a.truck.axle}mm (${a.truck.width})`, b: `${b.truck.axle}mm (${b.truck.width})`, key: s => s.truck.axle, priceA: a.truck.priceRange, priceB: b.truck.priceRange, pairNote: '√ó2' },
        { cat: '‚öôÔ∏è Wheels', a: `${a.wheel.diameter}mm ${a.wheel.durometer}`, b: `${b.wheel.diameter}mm ${b.wheel.durometer}`, key: s => s.wheel.diameter + s.wheel.durometer, priceA: a.wheel.priceRange, priceB: b.wheel.priceRange },
        { cat: 'üî© Bearings', a: a.bearing.rating, b: b.bearing.rating, key: s => s.bearing.rating, priceA: a.bearing.priceRange, priceB: b.bearing.priceRange },
        { cat: 'üí∞ Total', a: `$${a.totalLow}‚Äì$${a.totalHigh}`, b: `$${b.totalLow}‚Äì$${b.totalHigh}`, key: s => s.totalLow }
      ];

      let html = `<div class="compare-col"><h3 class="setup-a">${a.style.icon} Setup A</h3>`;
      rows.forEach(r => {
        const diff = r.key(a) !== r.key(b);
        html += `<div class="compare-cell ${diff ? 'compare-diff' : 'compare-same'}">
          <div class="cat">${r.cat}</div>
          <div class="val">${r.a}</div>
          ${r.priceA ? `<div class="price">$${r.priceA[0]}‚Äì$${r.priceA[1]}${r.pairNote ? ' '+r.pairNote : ''}</div>` : ''}
        </div>`;
      });
      html += '</div><div class="compare-col"><h3 class="setup-b">${b.style.icon} Setup B</h3>';
      // Fix: use template literal properly
      html = html.replace('${b.style.icon}', b.style.icon);
      rows.forEach(r => {
        const diff = r.key(a) !== r.key(b);
        html += `<div class="compare-cell ${diff ? 'compare-diff' : 'compare-same'}">
          <div class="cat">${r.cat}</div>
          <div class="val green">${r.b}</div>
          ${r.priceB ? `<div class="price">$${r.priceB[0]}‚Äì$${r.priceB[1]}${r.pairNote ? ' '+r.pairNote : ''}</div>` : ''}
        </div>`;
      });
      html += '</div>';
      document.getElementById('compare-grid').innerHTML = html;
    }
  </script>
</body>
</html>
